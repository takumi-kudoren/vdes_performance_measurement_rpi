# AGENTS.md

## 目的

このプロジェクトでは「誰が読んでも理解できる」ことを最優先にし、実装・コメント・ログ・命名・例外処理の統一を通じて保守性を高める。

---

## 1. コメント・ドキュメント（必須）

- インラインコメント、docstring、logger メッセージは **すべて日本語** で書く。
- 用語・文体はプロジェクト内で統一し、表現の揺れを避ける。
- コメントは「何をしているか」より **なぜそうするか（意図・理由・制約）** を中心に書く。

### docstring の基本構造（推奨）

- 概要 → 引数 → 戻り値 → 例外 → 補足（必要なら）
- 書き方に迷ったら、同種処理の既存ファイルに合わせる。

---

## 2. 可読性と複雑さ（最重要）

- 「短い・賢そう」より **理解しやすい** を優先する。
- 初心者でも流れを追えるように、処理は手順を明示して書く。
- 上から下へ読むだけで、処理の流れが追える構造にする。
- 処理の入口から終了までの判断経路が明確になるように記述する。
- 1 行に詰め込まない（ワンライナー if、過度なチェーン、難読な式は避ける）。
- 1 ファイル内に複数の役割の関数がある場合は、メイン処理・補助処理などの区別が一目で分かるよう、コメントで明示的に区切る。

### 避けたい記法（原則）

- 可読性を下げるリスト内包表記の多用
- ネストしたラムダ式
- 過度なデコレーター
- 省略しすぎる書き方（意図が読めない短縮）

---

## 3. 実装ガイドライン（必須）

### 3.1 設計・分割

- **1 関数＝ 1 責務**。複数の処理を詰め込まない。
- ネストを浅くするために **ガード節（早期リターン）** を優先する。
- 不必要な抽象化をしない（安易にクラス化・継承しない）。

### 3.2 命名

- 変数・関数名で意図が伝わるようにする（説明より命名を優先）。
- 命名ルールはプロジェクト既存に合わせる（例：snake_case / PascalCase）。
- 不要な略語は避ける（読み手が推測しないで済む名前にする）。

### 3.3 依存関係

- 修正時は必ず影響範囲（関連関数・モジュール・テスト）を確認する。
- 外部ライブラリは最小限。標準ライブラリで実現できるなら優先する。

---

## 4. ログ出力（必須）

- logger を活用し、以下を明示する：
    - 処理の開始 / 終了
    - 例外的分岐
    - エラー・例外発生時の状況
- ログメッセージは **利用者・開発者が状況を理解できる日本語** にする。

### ログの表現（推奨）

- 形式を統一する（例：`開始: ...` / `終了: ...` / `異常: ...`）
- 例外を投げる前に、原因が追える情報（入力・状態）をログに残す。

---

## 5. プロジェクト全体の統一（必須）

- 新規実装・修正時は、既存コードの文体・手順・ログ表現に合わせる。
- 統一対象（最低限）：
    1. コメントの文体・粒度
    2. docstring の構造
    3. ログの開始/終了/異常の表現
    4. 命名ルール
    5. 例外処理とログの組み合わせ方

---

## 6. レビュー方針（推奨）

- 個人の癖ではなく **プロジェクトとしての統一** を重視する。
- 指摘は「このプロジェクトでは X なので Y に合わせましょう」の形で行う。

---

## 7. 依頼・機能追加の対応（必須）

- 依頼を受けたら、すぐに実装せず **まず認識合わせ** を行う。
- 相手が答えやすい質問で確認する（例：「〜のように直す認識で合っていますか？」）。
- 認識合わせを省略しての実装は避ける（誤実装防止のため）。
- **指示・依頼された内容以外の機能や挙動は導入しない。**
- 「ついでに直す」「あると便利そうだから追加する」といった判断は行わない。
- 仕様に含まれていない修正（挙動変更・例外追加・ログ追加・依存追加など）が必要だと判断した場合は、**実装せず、必ず事前に相談・認識合わせを行う**。
- 既存の問題や改善点に気づいた場合は、修正は行わず **指摘・提案に留める**。
